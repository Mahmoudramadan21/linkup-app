/*
 * =============================================================================
 *  stories.module.css
 * =============================================================================
 *
 * Complete styling for the Stories feature:
 *   • Horizontal stories tray (home feed)
 *   • Full-screen story viewer with progress bars and navigation
 *   • Create Story modal with canvas editor (text, colors, fonts, drag & drop)
 *   • Story report / delete modals
 *   • Story viewers list modal
 *   • Reply input in viewer
 *
 * Key Features:
 *   • Vibrant gradient ring for unviewed stories (conic-gradient animation)
 *   • Full dark mode + high contrast support
 *   • WCAG 2.1 AA compliant (focus rings, proper contrast, screen reader ready)
 *   • Respects prefers-reduced-motion
 *   • Mobile-first responsive + touch-friendly
 *   • Performance-optimized with will-change and GPU acceleration
 *   • Consistent with global design tokens and Tailwind system
 */

@tailwind components;
@tailwind utilities;

/* ==========================================================================
   Custom Keyframe – Rotating gradient ring for unviewed stories
   ========================================================================== */
@keyframes storyRingRotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ==========================================================================
   Accessibility – Disable heavy animations for reduced motion preference
   ========================================================================== */
@media (prefers-reduced-motion: reduce) {
  .storyRingPulse,
  .stories__viewer_like_animate,
  .stories__viewer_progress_fill,
  .stories__viewer_avatar_stack {
    animation: none !important;
  }
}

/* ==========================================================================
   Stories Tray – Main container and header (visible on home/feed)
   ========================================================================== */
.stories {
  @apply flex flex-col items-start bg-[var(--section-bg)] py-lg px-md sm:px-lg lg:px-xl transition-colors duration-medium;
}
.stories__container {
  @apply card mx-auto w-full px-md py-sm;
}
.stories__title {
  @apply text-primary-bold mb-sm tracking-tight md-down:text-lg sm-down:text-lg;
}

/* ==========================================================================
   Stories Horizontal Bar – Scrollable tray of user avatars
   ========================================================================== */
.stories__feed {
  @apply flex gap-md;
}
.stories__bar {
  @apply flex items-center gap-md pb-md overflow-x-auto scrollbar-hidden snap-x snap-mandatory scroll-smooth;
}
.stories__skeleton {
  @apply rounded-md animate-pulse;
}

/* Avatar item in tray */
.stories__avatar_wrapper {
  @apply flex flex-col md:flex-row items-center gap-2 p-3 cursor-pointer transition-transform duration-fast snap-center;
}
.stories__avatar_wrapper.secondary {
  @apply flex-col p-0;
}

/* Skeleton states inside tray */
.stories__avatar_ring.stories__skeleton { @apply avatar--ring; }
.stories__avatar.stories__skeleton { @apply avatar--inner; }
.stories__username.stories__skeleton { @apply w-16 h-3 mt-xs rounded; }

/* Active/selected story highlight */
.stories__avatar_selected { @apply bg-[var(--card-bg)] rounded-2xl; }

/* Gradient ring for unviewed stories – animated conic gradient */
.stories__avatar_ring_unviewed {
  @apply relative inline-flex rounded-full;
}
.stories__bar .stories__avatar_ring_unviewed {
  @apply border-none;
}
.stories__avatar_ring_unviewed::before {
  content: "";
  @apply absolute inset-0 rounded-full p-[2px];
  background: conic-gradient(
    var(--linkup-purple),
    var(--linkup-teal),
    var(--linkup-orange),
    var(--linkup-purple-dark),
    var(--linkup-purple)
  );
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  animation: storyRingRotate 4s linear infinite;
}
.stories__avatar_ring_unviewed img {
  @apply rounded-full;
}

/* Viewed story ring – simple border */
.stories__avatar_ring_viewed {
  @apply rounded-full border-2 border-[var(--border-color)];
  background: transparent;
}

.stories__avatar_ring { @apply avatar--ring; }
.stories__avatar { @apply avatar--inner; }
.stories__username {
  @apply text-secondary mt-xs truncate max-w-[80px] sm-down:max-w-[60px];
}

/* ==========================================================================
   Story Viewer Modal – Full-screen story experience
   ========================================================================== */
.stories__viewer_modal_overlay {
  @apply modal-overlay z-50 flex items-center justify-center transition-opacity duration-medium;
}
.stories__viewer_modal {
  @apply modal--lg h-full flex flex-col md:flex-row touch-action-pan-y animate-fadeInModal;
}

/* Header (user info + close button) */
.stories__viewer_header {
  @apply absolute top-0 left-0 right-0 p-md z-10 bg-gradient-to-b from-[rgba(var(--app-bg-rgb),0.2)] to-transparent;
}
.stories__viewer_user { @apply flex justify-between items-center gap-sm; }
.stories__viewer_avatar { @apply avatar--md; }
.stories__viewer_username { @apply text-white font-semibold; }
.stories__viewer_count { @apply text-gray-100 ml-xs; }
.stories__viewer_close {
  @apply text-[var(--text-muted)] hover:text-[var(--linkup-purple)] focus-ring-teal p-sm rounded-full transition-all duration-fast;
}

/* Main viewer layout */
.stories__viewer_main {
  @apply flex flex-col md:flex-row gap-0 flex-1 w-full overflow-hidden pt-xl;
}
.stories__viewer_users {
  @apply w-full mb-4 md:mb-0 md:w-[240px] h-fit md:h-full bg-[var(--section-bg)] flex gap-sm md:flex-col overflow-x-auto md:overflow-y-auto flex-shrink-0 sm-down:flex-row sm-down:overflow-x-auto scrollbar-hidden;
}

/* Current story container */
.stories__viewer_story {
  @apply relative flex items-center justify-center w-full max-w-[420px] h-full mx-auto rounded-lg overflow-hidden bg-[var(--card-bg)] sm-down:max-w-[90vw];
  aspect-ratio: var(--story-aspect-w) / var(--story-aspect-h);
}
.stories__viewer_story_header {
  @apply flex justify-between items-center p-sm pt-lg absolute top-0 left-0 right-0 z-30 bg-gradient-to-b from-[rgba(var(--app-bg-rgb),0.3)] to-transparent;
}
.stories__viewer_menu_button {
  @apply bg-transparent border-none text-[var(--text-primary)] hover:bg-[var(--border-color)] focus-ring-teal p-sm rounded-full transition-all duration-fast;
}
.stories__viewer_menu {
  @apply card p-2 absolute top-12 right-4 z-40 min-w-[180px] animate-fadeInModal;
}
.stories__viewer_menu_item {
  @apply flex items-center gap-sm px-sm py-sm bg-transparent border-none w-full text-left cursor-pointer text-secondary hover:bg-[var(--card-bg)] focus-ring-teal transition-all duration-fast rounded-md;
}

/* Progress bars at top */
.stories__viewer_progress {
  @apply absolute top-sm left-sm right-sm flex gap-xs z-10;
}
.stories__viewer_progress_bar {
  @apply flex-1 h-1 rounded-full overflow-hidden bg-[rgba(var(--border-color-rgb),0.3)];
}
.stories__viewer_progress_fill {
  @apply h-full bg-[var(--linkup-purple)] will-transform;
}

/* Media & content */
.stories__viewer_content { @apply h-full w-full flex items-center justify-center animate-fadeInModal; }
.stories__viewer_media { @apply absolute inset-0 w-full h-full object-cover; }

/* Latest viewers (hearts) */
.stories__viewer_latest_viewers {
  @apply flex items-center gap-xs z-10 cursor-pointer hover:opacity-90 transition-opacity duration-fast focus-ring-teal;
}
.stories__viewer_avatars_stack { @apply flex -space-x-2; }
.stories__viewer_avatar_stack {
  @apply avatar--sm will-transform animate-buttonScale;
}

/* Bottom actions (like, reply, etc.) */
.stories__viewer_actions {
  @apply absolute bottom-sm left-0 right-0 py-sm px-lg flex justify-between items-center gap-md z-10;
}
.stories__viewer_action {
  @apply text-[var(--text-primary)] flex items-center gap-xs hover:text-[var(--linkup-purple)] focus-ring-teal transition-all duration-fast;
}
.stories__viewer_like_animate { @apply animate-heartPulse; }

/* Tap navigation areas */
.stories__viewer_nav { @apply absolute inset-0 flex; }
.stories__viewer_nav_prev,
.stories__viewer_nav_next { @apply w-1/2 h-full cursor-pointer; }
.stories__viewer_nav_hint {
  @apply absolute top-1/2 -translate-y-1/2 text-[var(--text-muted)] opacity-60 will-transform animate-swipeHint;
}
.stories__viewer_nav_prev .stories__viewer_nav_hint {
  @apply left-sm transform rotate-180 -translate-y-1/2;
}
.stories__viewer_nav_next .stories__viewer_nav_hint {
  @apply right-sm transform -translate-y-1/2;
}

/* ==========================================================================
   Reply Input in Viewer
   ========================================================================== */
.stories__viewer_reply_container {
  @apply flex items-end flex-grow gap-xs z-20 rounded-full px-md py-sm shadow-lg border border-white max-w-md mx-auto;
}
.stories__viewer_reply_input {
  @apply flex-1 bg-transparent text-white placeholder:text-gray-200 outline-none resize-none max-h-20 overflow-y-auto scrollbar-hidden text-sm;
  caret-color: var(--linkup-purple);
}
.stories__viewer_reply_input:focus {
  @apply placeholder:text-transparent;
}
.stories__viewer_reply_send {
  @apply bg-transparent border-none text-sm font-medium cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed transition-opacity;
}
.stories__viewer_reply_sending { @apply text-xs; }

/* ==========================================================================
   Story Report Modal
   ========================================================================== */
.story-report-modal__overlay { @apply modal-overlay z-50 transition-opacity duration-medium; }
.story-report-modal { @apply modal--sm animate-fadeInModal; }
.story-report-modal__header { @apply flex items-center justify-between mb-md; }
.story-report-modal__title { @apply text-primary-bold; }
.story-report-modal__close {
  @apply text-[var(--text-muted)] hover:text-[var(--linkup-purple)] focus-ring-teal p-sm rounded-full transition-all duration-fast;
}
.story-report-modal__form { @apply flex flex-col gap-sm; }
.story-report-modal__options { @apply flex flex-col gap-xs; }
.story-report-modal__label {
  @apply flex items-center gap-xs text-secondary hover:text-[var(--linkup-purple)] transition-all duration-fast;
}
.story-report-modal__error { @apply text-secondary text-center mt-sm; }
.story-report-modal__buttons { @apply flex gap-sm mt-md; }
.story-report-modal__button { @apply btn-rounded--purple flex-1; }
.story-report-modal__cancel-button {
  @apply btn-rounded flex-1 bg-[var(--section-bg)] text-[var(--text-primary)] hover:bg-[var(--border-color)] focus-ring;
}

/* ==========================================================================
   Story Delete Confirmation Modal
   ========================================================================== */
.story-delete-modal__overlay { @apply modal-overlay z-50 transition-opacity duration-medium; }
.story-delete-modal { @apply modal--sm text-center animate-fadeInModal; }
.story-delete-modal__title { @apply text-primary-bold mb-md; }
.story-delete-modal__message { @apply text-secondary mb-md; }
.story-delete-modal__buttons { @apply flex gap-sm mt-md; }
.story-delete-modal__button {
  @apply btn-rounded flex-1 bg-[var(--error)] hover:bg-[rgba(var(--error-rgb),0.9)] focus-ring;
}
.story-delete-modal__cancel-button {
  @apply btn-rounded flex-1 bg-[var(--section-bg)] text-[var(--text-primary)] hover:bg-[var(--border-color)] focus-ring;
}

/* ==========================================================================
   Create Story Modal – Canvas Editor
   ========================================================================== */
.create-story-modal__overlay { @apply modal-overlay z-50 transition-opacity duration-medium; }
.create-story-modal__container {
  @apply modal--lg overflow-y-auto scrollbar-thin-purple animate-fadeInModal;
}
.create-story-modal__header {
  @apply flex justify-between items-center bg-gradient-to-b from-[rgba(var(--app-bg-rgb),0.05)] to-transparent;
}
.create-story-modal__title { @apply text-primary-bold; }
.create-story-modal__close {
  @apply text-[var(--text-muted)] hover:text-[var(--linkup-purple)] focus-ring-teal p-sm rounded-full transition-all duration-fast;
}
.create-story-modal__content {
  @apply flex flex-col md:flex-row gap-md sm-down:flex-col;
}

/* Canvas Area */
.create-story-modal__canvas-wrapper {
  @apply relative w-full max-w-[540px] rounded-lg overflow-hidden bg-black shadow-md;
  aspect-ratio: var(--story-aspect-w) / var(--story-aspect-h);
}
.create-story-modal__uploading {
  @apply absolute inset-0 flex items-center justify-center bg-black/60 z-20;
}
.create-story-modal__uploading-text { @apply text-[var(--card-bg)] text-base; }
.create-story-modal__canvas {
  @apply w-full h-full rounded-lg transition-all duration-fast will-transform;
}
.create-story-modal__canvas--draggable { @apply cursor-grab; }
.create-story-modal__canvas--dragging {
  @apply cursor-grabbing opacity-90 scale-95;
}
.create-story-modal__video-control {
  @apply absolute top-xs left-xs btn-rounded bg-[var(--linkup-purple)] hover:bg-[var(--linkup-teal-light)] focus-ring-teal;
}

/* Toolbar (right panel) */
.create-story-modal__toolbar {
  @apply w-full md:w-[320px] flex flex-col gap-md sm-down:w-full;
}
.create-story-modal__user { @apply flex items-center gap-sm; }
.create-story-modal__avatar { @apply avatar--md; }
.create-story-modal__username { @apply text-primary-bold text-base; }
.create-story-modal__handle { @apply text-secondary; }

/* Text editor controls */
.create-story-modal__text-input { @apply flex flex-col gap-xs; }
.create-story-modal__text-input-label { @apply text-secondary font-semibold; }
.create-story-modal__text-input-field {
  @apply p-sm border border-[var(--border-color)] rounded-lg bg-[var(--section-bg)] text-[var(--text-primary)] w-full focus-ring-teal font-[Lora,Montserrat,Pacifico,Roboto-Condensed,Oswald,Playfair-Display,Arial,sans-serif];
}

/* Color & Font pickers */
.create-story-modal__color-picker,
.create-story-modal__font-picker,
.create-story-modal__size-slider,
.create-story-modal__alignment { @apply flex flex-col gap-xs; }
.create-story-modal__color-picker-label,
.create-story-modal__font-picker-label { @apply text-secondary font-semibold; }

.create-story-modal__color-options { @apply grid grid-cols-6 gap-xs; }
.create-story-modal__color-option {
  @apply w-8 h-8 rounded-full border-2 border-transparent hover:scale-110 transition-transform duration-fast;
}
.create-story-modal__color-option--selected {
  @apply border-2 border-[var(--linkup-purple)];
}

.create-story-modal__font-options {
  @apply flex gap-xs overflow-x-auto scrollbar-thin-purple;
}
.create-story-modal__font-option {
  @apply p-sm rounded-lg border-2 border-transparent bg-[var(--section-bg)] text-[var(--text-primary)] hover:bg-[var(--border-color)] font-[Lora,Montserrat,Pacifico,Roboto-Condensed,Oswald,Playfair-Display,Arial,sans-serif];
}
.create-story-modal__font-option--selected {
  @apply border-2 border-[var(--linkup-purple)];
}

/* Action buttons (Add Text, Undo, Share, etc.) */
.create-story-modal__actions { @apply flex flex-col gap-sm; }
.create-story-modal__actions-group { @apply flex gap-sm flex-1 max-h-10; }
.create-story-modal__action-btn {
  @apply btn-rounded flex items-center gap-xs hover:opacity-95 focus-ring-teal;
}
.create-story-modal__action-btn--add-media {
  @apply bg-[var(--section-bg)] text-[var(--text-primary)] hover:bg-[var(--border-color)];
}
.create-story-modal__action-btn--add-text {
  @apply bg-[var(--linkup-purple)] hover:bg-[var(--linkup-purple-light)];
}
.create-story-modal__action-btn--undo,
.create-story-modal__action-btn--redo {
  @apply bg-[var(--neutral-gray-dark)] hover:bg-[var(--neutral-gray-light)];
}
.create-story-modal__action-btn--discard {
  @apply bg-[var(--error)] hover:bg-[rgba(var(--error-rgb),0.9)];
}
.create-story-modal__action-btn--share { @apply btn-rounded--success; }
.create-story-modal__action-btn--disabled { @apply btn-rounded--disabled; }

/* Mode selector (Media / Text) */
.create-story-modal__mode-selector {
  @apply m-auto my-lg w-full md:w-[320px] flex flex-col gap-md items-center sm-down:w-full;
}
.create-story-modal__mode-btn {
  @apply flex flex-col justify-center items-center text-center gap-md p-lg md:py-[36px] w-full max-w-[280px] rounded-lg text-[var(--text-primary)] font-medium cursor-pointer transition-all duration-medium focus-ring-teal;
}
.create-story-modal__mode-btn--media {
  background: var(--gradient-purple-orange-vertical);
  @apply hover:brightness-110;
}
.create-story-modal__mode-btn--text {
  background: var(--gradient-green-vertical);
  @apply hover:brightness-110;
}
.create-story-modal__mode-icon {
  @apply text-[var(--linkup-purple)] bg-gray-100 rounded-full p-sm box-content;
}
.create-story-modal__preview-btn {
  @apply btn-rounded bg-[var(--linkup-purple)] hover:bg-[var(--linkup-teal-light)] focus-ring-teal flex items-center justify-center;
}
.create-story-modal__recording-timer {
  @apply flex items-center justify-center font-medium text-secondary bg-black/60 px-sm py-xs rounded-lg;
}

/* Video Trimmer (inside create modal) */
.create-story-modal__video-trimmer { @apply flex flex-col gap-sm; }
.create-story-modal__trimmer-container { @apply relative flex items-center gap-sm; }

/* Custom Range Slider Styles */
.slider { @apply relative w-full h-12; }
.slider__track {
  @apply absolute rounded-full h-2 bg-[var(--border-color)] w-full top-1/2 transform -translate-y-1/2 z-10;
}
.slider__range,
.slider__progress {
  @apply absolute rounded-full h-2 bg-[var(--linkup-purple)] top-1/2 transform -translate-y-1/2 z-20 transition duration-progress ease-linear;
}
.slider__left-value,
.slider__right-value { @apply absolute text-secondary top-full mt-xs; }
.slider__left-value { @apply left-0; }
.slider__right-value { @apply right-0; }

.thumb {
  @apply absolute w-full h-12 -top-2 appearance-none cursor-pointer focus-ring-teal z-30;
}
.thumb::-webkit-slider-thumb,
.thumb::-moz-range-thumb {
  @apply appearance-none w-5 h-5 bg-[var(--card-bg)] border-2 border-[var(--linkup-purple)] rounded-full shadow-md hover:scale-110 transition-transform duration-fast;
}
.thumb--zindex-3 { @apply z-30; }
.thumb--zindex-4 { @apply z-40; }
.thumb--zindex-5 { @apply z-50; }

/* ==========================================================================
   Story Viewers List Modal
   ========================================================================== */
.story-viewers-modal { @apply modal overflow-y-auto scrollbar-thin-purple animate-fadeInModal; }
.story-viewers-modal__overlay { @apply modal-overlay z-50 transition-opacity duration-medium; }
.story-viewers-modal__header { @apply flex items-center justify-between mb-md; }
.story-viewers-modal__title { @apply text-primary-bold; }
.story-viewers-modal__counts { @apply flex items-center gap-2 text-secondary ml-xs; }
.story-viewers-modal__close {
  @apply text-[var(--text-muted)] hover:text-[var(--linkup-purple)] focus-ring-teal p-sm rounded-full transition-all duration-fast;
}
.story-viewers-modal__list { @apply flex flex-col gap-sm; }
.story-viewers-modal__item { @apply flex items-center gap-sm; }
.story-viewers-modal__avatar { @apply avatar--md; }
.story-viewers-modal__username { @apply text-secondary; }
.story-viewers-modal__profile-name { @apply text-secondary font-medium; }
.story-viewers-modal__like-icon {
  @apply text-[var(--error)] flex items-center justify-center w-6 h-6 will-transform animate-heartPulse;
}
.story-viewers-modal__retry-button {
  @apply btn-rounded text-secondary hover:bg-[var(--border-color)] focus-ring-teal;
}
.story-viewers-modal__retry-button:disabled { @apply btn-rounded--disabled; }

/* States */
.stories__loading,
.stories__empty,
.story-viewers-modal__loading,
.story-viewers-modal__empty { @apply loading--lg text-center mt-lg; }
.stories__error,
.story-viewers-modal__error { @apply text-secondary text-center mt-sm; }

/* ==========================================================================
   Accessibility – Unified focus styles across all interactive elements
   ========================================================================== */
.stories__avatar_wrapper:focus-visible,
.stories__viewer_action:focus-visible,
.stories__viewer_latest_viewers:focus-visible,
.stories__viewer_menu_button:focus-visible,
.stories__viewer_menu_item:focus-visible,
.create-story-modal__close:focus-visible,
.create-story-modal__action-btn:focus-visible,
.create-story-modal__mode-btn:focus-visible,
.create-story-modal__preview-btn:focus-visible,
.create-story-modal__canvas:focus-visible,
.story-report-modal__close:focus-visible,
.story-report-modal__button:focus-visible,
.story-report-modal__cancel-button:focus-visible,
.story-delete-modal__button:focus-visible,
.story-delete-modal__cancel-button:focus-visible,
.story-viewers-modal__retry-button:focus-visible {
  @apply focus-ring-teal;
}

/* ==========================================================================
   Performance Hints – GPU acceleration for animated elements
   ========================================================================== */
.stories__avatar_ring_unviewed,
.stories__viewer_nav_hint,
.stories__viewer_progress_fill,
.stories__viewer_avatar_stack,
.create-story-modal__canvas {
  will-change: transform, opacity;
}